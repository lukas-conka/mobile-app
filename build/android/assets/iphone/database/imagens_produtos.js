function getTableImagensProdutos(){return"tb_imagens_produtos"}function dbLoad(){var e=Ti.Database.open(Ti.App.Properties.getString(DATABASE_FILE));return e}function createImagensProdutos(){db=dbLoad(),db.execute("CREATE TABLE IF NOT EXISTS "+getTableImagensProdutos()+"(\n		id INTEGER PRIMARY KEY, img_id INTEGER, img_caminho TEXT, img_ordem INTEGER,\n		img_principal INTEGER, fk_produtos INTEGER, fk_cores INTEGER, ep_id INTEGER\n		);"),db.close()}function dropImagensProdutos(){db=dbLoad(),db.execute("DROP TABLE IF EXISTS "+getTableImagensProdutos()),db.close()}function insertImagensProdutos(e,i,t,o,a,l,r){db=dbLoad(),db.execute("INSERT INTO "+getTableImagensProdutos()+" (\n		img_id, img_caminho, img_ordem, img_principal, fk_produtos, fk_cores, ep_id) \n	VALUES (?,?,?,?,?,?,?)",e,i,t,o,a,l,r),db.close()}function selectImagemPrincipal(e){db=dbLoad();var i="notfound",t=db.execute("SELECT fk_cores FROM tb_info_produtos WHERE fk_produtos = "+e+" AND ifp_destaque = 1 LIMIT 1");if(t.isValidRow()){var o=t.fieldByName("fk_cores"),a="SELECT img_caminho FROM "+getTableImagensProdutos()+" WHERE img_principal = 1 AND fk_produtos = "+e+" AND fk_cores = "+o+" LIMIT 1";Ti.API.info("selectImagemPrincipal="+a);var l=db.execute(a);l.isValidRow()&&(i=l.fieldByName("img_caminho")),"android"==Ti.Platform.osname&&db.close()}return i}function selectImagemVariantePrincipal(e,i){db=dbLoad();var t="notfound",o=db.execute("SELECT img_caminho FROM "+getTableImagensProdutos()+" WHERE img_principal = 1 AND fk_produtos = "+e+" AND fk_cores = "+i+" LIMIT 1");return o.isValidRow()&&(t=o.fieldByName("img_caminho")),"android"==Ti.Platform.osname&&db.close(),t}function selectImagensPorVariante(e,i){db=dbLoad();for(var t=[],o=db.execute("SELECT img_caminho FROM "+getTableImagensProdutos()+" WHERE fk_produtos = "+e+" AND fk_cores = "+i+" ORDER BY img_ordem ASC");o.isValidRow();){var a=o.fieldByName("img_caminho");t.push(a),o.next()}return"android"==Ti.Platform.osname&&db.close(),t}function selectImagensProdutos(e){db=dbLoad();for(var i=[],t=db.execute("SELECT fk_cores FROM tb_info_produtos WHERE fk_produtos = "+e+" AND ifp_destaque = 1 LIMIT 1"),o=t.fieldByName("fk_cores"),a=db.execute("SELECT img_caminho FROM "+getTableImagensProdutos()+" WHERE img_principal = 0 AND fk_produtos = "+e+" AND fk_cores = "+o+" ORDER BY img_ordem ASC");a.isValidRow();){var l=a.fieldByName("img_caminho");i.push(l),a.next()}return"android"==Ti.Platform.osname&&db.close(),i}function selectallImagensProdutos(){db=dbLoad();var e=db.execute("SELECT img_caminho FROM "+getTableImagensProdutos());return"android"==Ti.Platform.osname&&db.close(),e}function processImagensProdutos(e){dropImagensProdutos(),createImagensProdutos();for(var i=JSON.parse(e),t=0;t<i.length;t++)if(0==i[t].img_excluido){var o=i[t].img_id,a=i[t].img_caminho,l=i[t].img_ordem,r=i[t].img_principal,_=i[t].fk_produtos,d=i[t].fk_cores,s=i[t].ep_id;insertImagensProdutos(o,a,l,r,_,d,s)}}