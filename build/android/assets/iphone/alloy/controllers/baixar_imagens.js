function __processArg(t,e){var i=null;return t&&(i=t[e]||null,delete t[e]),i}function Controller(){function t(){o.activityIndicator.setMessage("Download de imagens concluido"),goTo("seleciona_cliente")}function e(){o.activityIndicator.setMessage("Download de imagens concluido"),goTo("softwares")}function i(t){var e=t.URL;d[p]=Ti.Network.createHTTPClient({timeout:5e3}),d[p].onerror=function(){d[p]=null,Ti.API.info("Erro ao Baixar Imagem="+e),p++,r()},d[p].onload=function(){s(t.folderName,t.fileName,this.responseData),d[p]=null,r()};try{d[p].open("GET",e),d[p].send()}catch(i){d[p]=null,Ti.API.info("Erro ao Baixar Imagem="+e),p++,r()}}function r(){if(p>0&&null==c[p-1],p<c.length){var r=c[p],s=r.substring(r.lastIndexOf("/")+1);s=s,i({URL:r,fileName:s,folderName:h}),p++,o.activityIndicator.setMessage("Baixando imagem "+p+" de "+u+"...")}else Ti.App.Properties.setString(SYNC,"true"),Ti.App.Properties.setInt(DATABASE_VERSION,SOFTWARE_DB_VERSION),TEST_VERSION?e():t()}function s(t,e,i){var r=Ti.Filesystem.getFile(h,e);r.write(i)}function n(){o.activityIndicator.show()}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="baixar_imagens",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var o=this,a={},l={};o.__views.baixar_imagens=Ti.UI.createWindow({backgroundColor:"white",orientationModes:[Ti.UI.LANDSCAPE_LEFT,Ti.UI.LANDSCAPE_RIGHT],id:"baixar_imagens"}),o.__views.baixar_imagens&&o.addTopLevelView(o.__views.baixar_imagens),n?o.__views.baixar_imagens.addEventListener("open",n):l["$.__views.baixar_imagens!open!showIndicator"]=!0,o.__views.activityIndicator=Ti.UI.createActivityIndicator({id:"activityIndicator",message:"Carregando Imagens..."}),o.__views.baixar_imagens.add(o.__views.activityIndicator),a.destroy=function(){},_.extend(o,o.__views),arguments[0]||{},Ti.include("/database/imagens_produtos.js"),Ti.include("/database/aparencia.js"),Ti.include("/api/config.js");for(var h=getImagesFolder(),c=[],u=0,d=[],p=0,f=selectallImagensProdutos();f.isValidRow();){var g=f.fieldByName("img_caminho"),m=g.replace(/ /g,"%20"),y=Ti.Filesystem.getFile(h,m);y.exists()||(u++,c.push(URL_CAMINHO_IMAGENS+m)),f.next()}f.close();for(var v=selectallAparencia();v.isValidRow();){var g=v.fieldByName("apr_arquivo"),m=g.replace(/ /g,"%20"),y=Ti.Filesystem.getFile(h,m);y.exists()||(u++,c.push(URL_CAMINHO_IMAGENS+m)),v.next()}v.close(),r(),l["$.__views.baixar_imagens!open!showIndicator"]&&o.__views.baixar_imagens.addEventListener("open",n),_.extend(o,a)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;