function getTableCategorias(){return"tb_categorias"}function dbLoad(){var e=Ti.Database.open(Ti.App.Properties.getString(DATABASE_FILE));return e}function createCategorias(){db=dbLoad(),db.execute("CREATE TABLE IF NOT EXISTS "+getTableCategorias()+"(\n		id INTEGER PRIMARY KEY, cat_id INTEGER, cat_nome TEXT, ep_id INTEGER, cod_categora TEXT, parent INTEGER\n		);"),db.close()}function dropCategorias(){db=dbLoad(),db.execute("DROP TABLE IF EXISTS "+getTableCategorias()),db.close()}function insertCategorias(e,i,t,o){db=dbLoad(),db.execute("INSERT INTO "+getTableCategorias()+" (\n		cat_id, cat_nome, ep_id, parent) \n	VALUES (?,?,?,?)",e,i,t,o),db.close()}function selectallCategorias(){db=dbLoad();var e=db.execute("SELECT * FROM "+getTableCategorias());return db.close(),e}function selectAllMenuCategorias(e,i,t){db=dbLoad();var o;switch(Ti.API.info("softsw="+t),t){case"3":o=softwareThree(i);break;case"4":o=softwareFour(i);break;default:Ti.API.info("aqui="),o=softwareTwo(e,i)}Ti.API.info("query="+o);var a=db.execute(o);return db.close(),a}function softwareFour(e){return query="SELECT \n    tb_categorias.*, tb_marcas.mc_nome, tb_categoria_marca.fk_marca, tb_categoria_marca.fk_template\n    FROM tb_categorias\n	LEFT JOIN tb_categorias as sub1 ON sub1.parent = tb_categorias.cat_id\n	LEFT JOIN tb_categorias as sub2 ON sub2.parent = sub1.cat_id\n	INNER JOIN tb_categoria_marca ON tb_categoria_marca.fk_categoria = tb_categorias.cat_id\n	INNER JOIN tb_produtos ON tb_produtos.fk_categorias IN (tb_categorias.cat_id, sub1.cat_id, sub2.cat_id) \n	AND tb_produtos.fk_marca = tb_categoria_marca.fk_marca\n	INNER JOIN tb_marcas ON tb_marcas.mc_id = tb_categoria_marca.fk_marca\n	WHERE tb_categorias.ep_id = "+e+"\n	GROUP BY tb_categoria_marca.catm_id\n	ORDER BY tb_marcas.mc_nome ASC,\n	tb_categorias.cat_nome ASC"}function softwareThree(e){var i=Ti.App.Properties.getList(SELECTED_CLIENTS),t=i.toString();return query="SELECT \n    tb_categorias.*, tb_marcas.mc_nome, tb_categoria_marca.fk_marca, tb_categoria_marca.fk_template\n	FROM tb_categorias \n	LEFT JOIN tb_categorias as sub1 ON sub1.parent = tb_categorias.cat_id\n	LEFT JOIN tb_categorias as sub2 ON sub2.parent = sub1.cat_id\n	INNER JOIN tb_cliente ON tb_cliente.cl_id IN ("+t+")\n	INNER JOIN tb_cliente_marca ON tb_cliente_marca.fk_cliente = tb_cliente.cl_id\n	INNER JOIN tb_categoria_marca ON tb_categoria_marca.fk_marca = tb_cliente_marca.fk_marca \n	AND tb_categoria_marca.fk_categoria = tb_categorias.cat_id\n	INNER JOIN tb_produtos ON tb_produtos.fk_categorias IN (tb_categorias.cat_id, sub1.cat_id, sub2.cat_id) \n	AND tb_produtos.fk_marca = tb_categoria_marca.fk_marca\n	INNER JOIN tb_marcas ON tb_marcas.mc_id = tb_cliente_marca.fk_marca\n	WHERE tb_categorias.ep_id = "+e+"\n	GROUP BY tb_categorias.cat_id, tb_marcas.mc_id \n	ORDER BY tb_marcas.mc_nome ASC, tb_categorias.cat_nome ASC"}function softwareTwo(e){return query="SELECT tb_categoria_marca.fk_marca, tb_categoria_marca.fk_template, tb_categorias.* FROM tb_categorias LEFT JOIN tb_categorias as sub1 ON sub1.parent = tb_categorias.cat_id LEFT JOIN tb_categorias as sub2 ON sub2.parent = sub1.cat_id  INNER JOIN tb_categoria_marca ON tb_categoria_marca.fk_marca = "+e+" AND tb_categoria_marca.fk_categoria = tb_categorias.cat_id INNER JOIN tb_produtos ON tb_produtos.fk_categorias IN (tb_categorias.cat_id, sub1.cat_id, sub2.cat_id) AND tb_produtos.fk_marca = tb_categoria_marca.fk_marca GROUP BY tb_categorias.cat_id ORDER BY cat_nome"}function processCategorias(e){dropCategorias(),createCategorias();for(var i=JSON.parse(e),t=0;t<i.length;t++)if(0==i[t].cat_visivel&&0==i[t].cat_excluido){var o=i[t].cat_id,a=capitalizeFirstLetter(i[t].cat_nome),l=i[t].ep_id,r=i[t].parent;insertCategorias(o,a,l,r)}}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}