function getTableProdutos(){return"tb_produtos"}function dbLoad(){var e=Ti.Database.open(Ti.App.Properties.getString(DATABASE_FILE));return e}function createProdutos(){db=dbLoad(),db.execute("CREATE TABLE IF NOT EXISTS "+getTableProdutos()+"(\n		id INTEGER PRIMARY KEY, prd_id INTEGER, fk_categorias INTEGER, prd_nome TEXT,\n		prd_referencia TEXT, prd_sus_trib FLOAT, prd_ipi FLOAT, prd_icms FLOAT, prd_nome_colecao TEXT,\n		prd_dados_tecnicos TEXT, prd_dados_composicao TEXT, prd_dados_descricao TEXT, prd_data_inicio TEXT,\n		prd_data_fim TEXT, prd_data_prazo TEXT, prd_data_limite INTEGER, prd_peso FLOAT, prd_cub_a FLOAT,\n		prd_cub_l FLOAT, prd_cub_p FLOAT, prd_codigo_barra TEXT, ep_id INTEGER, fk_marca INTEGER, prd_grade INTEGER, fk_ncm INTEGER, prd_tipo INTEGER,\n		prd_cota TEXT\n		);"),db.close()}function dropProdutos(){db=dbLoad(),db.execute("DROP TABLE IF EXISTS "+getTableProdutos()),db.close()}function insertProdutos(e,i,t,o,a,l,r,_,d,s,n,c,f,p,h,g,y,I,u,w,T,v,b,m,E,C){db=dbLoad(),db.execute("INSERT INTO "+getTableProdutos()+" (\n		prd_id, fk_categorias, prd_nome, prd_referencia, prd_sus_trib, prd_ipi, prd_icms, prd_nome_colecao,\n		prd_dados_tecnicos, prd_dados_composicao, prd_dados_descricao, prd_data_inicio, prd_data_fim, prd_data_prazo,\n		prd_data_limite, prd_peso, prd_cub_a, prd_cub_l, prd_cub_p, prd_codigo_barra, ep_id, fk_marca, prd_grade, fk_ncm, prd_tipo, prd_cota) \n	VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)",e,i,t,o,a,l,r,_,d,s,n,c,f,p,h,g,y,I,u,w,T,v,b,m,E,C),db.close()}function selectallProdutos(){db=dbLoad();var e=db.execute("SELECT * FROM "+getTableProdutos());return e}function listaProdutosQuatro(e){db=dbLoad();var i="SELECT tb_produtos.prd_id, tb_produtos.prd_nome, tb_produtos.prd_referencia, tb_produtos.prd_codigo_barra, tb_info_produtos.ifp_id, tb_info_produtos.ifp_codigo, tb_info_produtos.ifp_valor_1, tb_info_produtos.ifp_valor_2, tb_info_produtos.ifp_valor_3, tb_info_produtos.ifp_qtde_minima, tb_imagens_produtos.img_caminho, tb_aparencia.apr_arquivo FROM tb_produtos INNER JOIN tb_categorias ON tb_categorias.cat_id = tb_produtos.fk_categorias INNER JOIN tb_info_produtos ON tb_info_produtos.fk_produtos = tb_produtos.prd_id AND tb_info_produtos.ifp_destaque = '1' INNER JOIN tb_imagens_produtos ON tb_imagens_produtos.fk_produtos = tb_produtos.prd_id AND tb_imagens_produtos.img_principal = 1 INNER JOIN tb_aparencia ON tb_aparencia.fk_marcas = tb_produtos.fk_marca AND tb_aparencia.apr_tipo = 'logo' AND tb_aparencia.apr_status = 1 ";if(""!=e){var t="WHERE tb_produtos.prd_nome LIKE '%"+e+"%' OR  tb_produtos.prd_referencia LIKE '%"+e+"%' OR  tb_produtos.prd_codigo_barra LIKE '%"+e+"%' ";i+=t}i+="GROUP BY tb_info_produtos.ifp_id ORDER BY tb_aparencia.fk_marcas,tb_produtos.prd_referencia";var o=db.execute(i);return db.close(),o}function selectProductById(e,i,t){db=dbLoad(),query="SELECT tb_produtos.fk_categorias,\n		tb_categoria_marca.fk_template,\n		tb_info_produtos.fk_cores,\n		tb_produtos.prd_referencia, \n		tb_produtos.prd_id, \n		tb_produtos.prd_icms, \n		tb_produtos.prd_ipi, \n		tb_produtos.prd_nome, \n		tb_produtos.prd_nome_colecao, \n		tb_produtos.prd_dados_tecnicos, \n		tb_produtos.prd_dados_composicao, \n		tb_produtos.prd_dados_descricao, \n		tb_produtos.prd_data_inicio, \n		tb_produtos.prd_data_fim, \n		tb_produtos.prd_data_prazo,\n		tb_produtos.prd_codigo_barra,\n		( SELECT MIN(tb_info_produtos.ifp_valor_"+t+" ) AS minValor \n		FROM tb_info_produtos \n		WHERE ( tb_info_produtos.fk_produtos = tb_produtos.prd_id ) ) AS minValor, \n		( SELECT MAX(tb_info_produtos.ifp_valor_"+t+" ) AS maxValor  \n		FROM tb_info_produtos \n		WHERE ( tb_info_produtos.fk_produtos = tb_produtos.prd_id ) ) AS maxValor \n		FROM tb_produtos\n		INNER JOIN tb_info_produtos ON tb_info_produtos.fk_produtos = tb_produtos.prd_id AND tb_info_produtos.ifp_destaque = 1 \n		LEFT JOIN tb_categorias ON tb_categorias.cat_id = tb_produtos.fk_categorias\n		LEFT JOIN tb_categorias as sub1 ON sub1.cat_id = tb_categorias.parent\n		LEFT JOIN tb_categorias as sub2 ON sub2.cat_id = sub1.parent \n		INNER JOIN tb_categoria_marca ON tb_categoria_marca.fk_categoria \n		IN (tb_categorias.cat_id, sub1.cat_id, sub2.cat_id) AND tb_categoria_marca.fk_marca = tb_produtos.fk_marca\n		WHERE tb_produtos.ep_id ="+i+" AND tb_produtos.prd_id = "+e;var o=db.execute(query);return db.close(),o}function selectProductsCount(e,i,t){db=dbLoad();var o="SELECT COUNT(*) AS total\n	FROM tb_produtos\n	INNER JOIN tb_info_produtos ON tb_info_produtos.fk_produtos = tb_produtos.prd_id\n	LEFT JOIN tb_categorias as cat ON cat.cat_id = "+e+"\n	LEFT JOIN tb_categorias as sub1 ON sub1.parent = cat.cat_id \n	LEFT JOIN tb_categorias as sub2 ON sub2.parent = sub1.cat_id\n	WHERE\n	tb_produtos.ep_id = "+t+" AND\n	tb_produtos.fk_categorias IN (cat.cat_id, sub1.cat_id, sub2.cat_id) AND\n	tb_produtos.fk_marca = "+i+" AND\n	tb_produtos.prd_data_inicio <> 0 AND\n	tb_produtos.prd_data_fim <> 0 \n	GROUP BY tb_info_produtos.fk_produtos";Ti.API.info("querycount="+o);for(var a=db.execute(o),l=0;a.isValidRow();)l++,a.next();var r=l;return db.close(),r}function selectProductsByPage(e,i,t,o,a){db=dbLoad(),query="SELECT	tb_produtos.prd_id, tb_produtos.prd_nome, tb_produtos.prd_referencia, tb_produtos.fk_categorias,tb_produtos.prd_data_inicio,\n	tb_produtos.prd_data_fim, tb_produtos.prd_data_prazo, tb_produtos.prd_data_limite, tb_info_produtos.fk_cores, \n	tb_info_produtos.ifp_valor_1, tb_info_produtos.ifp_valor_2, tb_info_produtos.ifp_valor_3\n	FROM tb_info_produtos\n	INNER JOIN tb_produtos ON tb_produtos.prd_id = tb_info_produtos.fk_produtos 	\n	LEFT JOIN tb_categorias as cat ON cat.cat_id = "+t+"\n	LEFT JOIN tb_categorias as sub1 ON sub1.parent = cat.cat_id \n	LEFT JOIN tb_categorias as sub2 ON sub2.parent = sub1.cat_id\n	WHERE tb_produtos.ep_id = "+e+" AND\n	tb_produtos.fk_categorias IN (cat.cat_id, sub1.cat_id, sub2.cat_id) AND\n	tb_produtos.fk_marca = "+i+" AND\n	tb_produtos.prd_data_inicio <> 0 AND\n	tb_produtos.prd_data_fim <> 0 AND\n	tb_info_produtos.ifp_destaque = 1\n	GROUP BY\n	tb_produtos.prd_id\n	ORDER BY\n	tb_produtos.prd_nome\n	LIMIT "+o+", "+a,Ti.API.info("selectProductsByPage="+query);var l=db.execute(query);return db.close(),l}function processProdutos(e){dropProdutos(),createProdutos();for(var i=JSON.parse(e),t=0;t<i.length;t++)if(0==i[t].prd_excluido){var o=i[t].prd_id,a=i[t].fk_categorias,l=i[t].prd_nome,r=i[t].prd_referencia,_=i[t].prd_sus_trib,d=i[t].prd_ipi,s=i[t].prd_icms,n=i[t].prd_nome_colecao,c=i[t].prd_dados_tecnicos,f=i[t].prd_dados_composicao,p=i[t].prd_dados_descricao,h=i[t].prd_data_inicio,g=i[t].prd_data_fim,y=i[t].prd_data_prazo,I=i[t].prd_data_limite,u=i[t].prd_peso,w=i[t].prd_cub_a,T=i[t].prd_cub_l,v=i[t].prd_cub_p,b=i[t].prd_codigo_barra,m=i[t].ep_id,E=i[t].fk_marca,C=i[t].prd_grade,k=i[t].fk_ncm,A=i[t].prd_tipo,N=i[t].prd_cota;insertProdutos(o,a,l,r,_,d,s,n,c,f,p,h,g,y,I,u,w,T,v,b,m,E,C,k,A,N)}}