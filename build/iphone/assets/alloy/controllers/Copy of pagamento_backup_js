function __processArg(t,e){var i=null;return t&&(i=t[e]||null,delete t[e]),i}function Controller(){function t(t){var i=t,s=[],n=[],o=r.listaclientes.sections[i.sectionIndex],a=o.getItemAt(i.itemIndex),l=a.cliente,c=consultaMaximoDesconto();c.fieldByName("rp_desc_especial");var h=c.fieldByName("rp_limite_desc_especial");for(O=0;h>=O;O++)s.push(O),n.push(O+"%");Titanium.UI.currentWindow;var u=Titanium.UI.createOptionDialog({options:n,destructive:2,cancel:0,title:"Desconto especial"});u.show(),u.addEventListener("click",function(t){e(i,l,s[t.index])})}function e(e,s,n){t[s]=n;var o=r.listaclientes.sections[e.sectionIndex],a=o.getItemAt(e.itemIndex);a.label_especial_botao.title=n+"%",o.updateItemAt(e.itemIndex,a),i(e,s)}function i(e,i){var s=d[i]*h[i]/100,n=d[i]-s,o=0;t[i]>0&&o++;var a=n*t[i]/100,l=n-a;d[i]/c[i];var u=l/c[i],p=getClienteCredito(i),_=p.fieldByName("cl_credito_utilizado"),f=p.fieldByName("cl_credito_total"),g=f-_-l,m=r.listaclientes.sections[e.sectionIndex],y=m.getItemAt(e.itemIndex),v=0;o>0&&(v=n-l,o=0),y.label_parcela.text=c[i]+"x de "+formatCurrency(u),y.label_desconto.text=formatCurrency(n-v),y.label_credito.text=formatCurrency(g),r.total_geral.text=formatCurrency(n-v),m.updateItemAt(e.itemIndex,y)}require("alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="Copy of pagamento_backup",this.args=arguments[0]||{},arguments[0]&&(__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate"));var r=this,s={};s.destroy=function(){},_.extend(r,r.__views),Ti.include("/api/config.js"),Ti.include("/database/clientes.js"),Ti.include("/database/carrinho.js"),Ti.include("/database/carrinho_pedido.js"),Ti.include("/database/prazo_medio.js"),Ti.include("/database/pedido.js"),Ti.include("/database/datas.js"),Ti.include("/database/representante.js");for(var n,o,a=0,l=[],c=[],t=[],h=[],u=[],d=[],p=0,f=[],g=0;7>g;g++)f[g]=100;Ti.App.Properties.getList(SOBRE_PEDIDO)&&(f=Ti.App.Properties.getList(SOBRE_PEDIDO));for(var m=Ti.App.Properties.getList(SELECTED_CLIENTS),g=0;g<m.length;g++){var y=consultaCliente(m[g]);if(y.isValidRow()){var v=y.fieldByName("cl_id"),T=y.fieldByName("cl_cnpj");c[v]=1,o=0,n=0;for(var E=consultaCarrinhoByPagamento(Ti.App.Properties.getString(SESSION_ID),m[g]);E.isValidRow();){var A=E.fieldByName("car_quantidade"),I=E.fieldByName("car_preco_unitario"),S=E.fieldByName("car_ipi"),x=A*I,N=x*S/100;o+=A,n=n+x+N,p+=n,E.next()}if(t[v]=0,h[v]=0,u[v]=0,d[v]=n,0==a){var O=100;a++}else var O=f[g];l.push({cliente:v,template:"item_cliente",label_porcentagem_botao:{title:O+"%"},label_cnpj:{text:T},label_peca:{text:o},label_bruto:{text:formatCurrency(n)},label_dias_botao:{title:"-"},label_prazo:{text:"0%"},label_especial_botao:{title:"0%"},label_volume:{text:"0%"},label_parcela:{text:"-"},label_desconto:{text:"-"},label_condicao:{text:"-"},label_credito:{text:"-"}})}}r.listaclientes.sections[0].setItems(l),_.extend(r,s)}var Alloy=require("alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;